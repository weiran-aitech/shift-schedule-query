<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { display: flex; gap: 30px; }
    .box { border: 1px solid #ccc; padding: 20px; border-radius: 8px; width: 250px; }
    input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; }
    button { padding: 8px 16px; }
  </style>
</head>
<body>
  <h1>Task Manager</h1>

  <div class="container">
    <div class="box">
      <h3>Signup</h3>
      <input id="signupUsername" placeholder="Username">
      <input type="password" id="signupPassword" placeholder="Password">
      <button onclick="signup()">Signup</button>
    </div>

    <div class="box">
      <h3>Login</h3>
      <input id="loginUsername" placeholder="Username">
      <input type="password" id="loginPassword" placeholder="Password">
      <button onclick="login()">Login</button>
    </div>
  </div>

  <h3 id="status">Not logged in</h3>

  <div id="taskSection" style="display:none;">
    <h3>Your Tasks</h3>
    <input id="taskTitle" placeholder="Task title">
    <textarea id="taskDescription" placeholder="Task description"></textarea>
    <button onclick="createTask()">Add Task</button>
    <ul id="taskList"></ul>
  </div>

  <script>
    const BASE_URL = "https://my-fastapi-app.onrender.com/api"; // change to your Render URL
    let token = null;

    async function signup() {
      const formData = new FormData();
      formData.append("username", document.getElementById("signupUsername").value);
      formData.append("password", document.getElementById("signupPassword").value);

      try {
        const res = await fetch(`${BASE_URL}/signup`, { method: "POST", body: formData });
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || "Signup failed");
        alert("Signup successful, now login!");
      } catch (err) {
        alert(err.message);
      }
    }

    async function login() {
      const formData = new FormData();
      formData.append("username", document.getElementById("loginUsername").value);
      formData.append("password", document.getElementById("loginPassword").value);

      try {
        const res = await fetch(`${BASE_URL}/login`, { method: "POST", body: formData });
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || "Login failed");

        token = data.access_token;
        document.getElementById("status").innerText = "Logged in as " + data.username;
        document.getElementById("taskSection").style.display = "block";
        loadTasks();
      } catch (err) {
        alert(err.message);
      }
    }

    async function createTask() {
      const body = {
        title: document.getElementById("taskTitle").value,
        description: document.getElementById("taskDescription").value
      };

      try {
        const res = await fetch(`${BASE_URL}/tasks`, {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || "Failed to add task");
        loadTasks();
      } catch (err) {
        alert(err.message);
      }
    }

    async function loadTasks() {
      try {
        const res = await fetch(`${BASE_URL}/tasks`, {
          headers: { "Authorization": `Bearer ${token}` }
        });
        const tasks = await res.json();
        const list = document.getElementById("taskList");
        list.innerHTML = "";
        tasks.forEach(t => {
          const li = document.createElement("li");
          li.textContent = `${t.title}: ${t.description || ""}`;
          list.appendChild(li);
        });
      } catch (err) {
        console.error(err);
      }
    }
  </script>
</body>
</html>
